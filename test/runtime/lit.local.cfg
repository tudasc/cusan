import subprocess

if config.cusan_use_workarounds:
    config.environment['NEOReadDebugKeys'] = '1'
    config.environment['DisableDeepBind'] = '1'
    config.environment['OMPI_MCA_memory'] = '^patcher'

def has_mpirun():
    try:
        subprocess.check_call(['mpirun', '--version'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        return True
    except subprocess.CalledProcessError:
        return False


config.available_features.add('openmpi' if has_mpirun() else '')